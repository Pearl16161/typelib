LIBSOURCES=Support.cpp Dictionary.cpp LineObject.cpp Main.cpp
GENSOURCES=CPPParser.cpp CPPLexer.cpp

SRCS=$(LIBSOURCES) $(GENSOURCES)
LIB=libgrammar.a

CXX=g++ -g -pipe -Wall
CCC=gcc -g -pipe -Wall

OBJS=$(subst cpp,o,$(SRCS))

all: grammar $(LIB)

$(LIB): $(OBJS)

grammar: CPP_parser.g
	cantlr CPP_parser.g
	touch grammar
	
%.o: %.cpp
	$(CXX) $< -c -o $@ -I.

clean:
	rm -f $(OBJS) $(GENSOURCES) CPPLexer.hpp CPPParser.hpp STDCTokenTypes.* typefind grammar
	make -C test clean

distclean:
	rm -f DEPENDANCES

ifeq ($(findstring clean,$(MAKECMDGOALS)),)
depend DEPENDANCES:: $(SRCS) | grammar
	mkdep -cgcc -oDEPENDANCES $(CPPFLAGS) $?

include DEPENDANCES
endif


